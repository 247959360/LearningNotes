{"version":3,"file":"vue.js","sources":["../src/util/index.js","../src/observer/index.js","../src/init/state.js","../src/init/init.js","../src/index.js"],"sourcesContent":["export function isObject(data) {\n  if (typeof data === 'object' && data !== null) {\n    return true;\n  } else {\n    return false;\n  }\n}\n","// data中的数据 重新定义\nimport { isObject } from '../util/index'\nimport { arrayMethods } from './array'\n\n// 递归处理 里面的数据可能很复杂\nclass Observer {\n  constructor(value) {\n    // 如果数据的层次过多 需要递归的去解析对象中的属性  依次增加 get和set\n    // vue3 使用了proxy 就不需要依次的递归了 支持监听整个对象 也不需要set和get\n    if(Array.isArray(value)) {\n      // value.__proto__ = arrayMethods\n      setArray()\n      this.observerArray(value)\n    } else {\n      this.walk(value)\n    }\n  }\n  walk(data) {\n    let keys = Object.keys(data)\n    keys.forEach((key) => {\n      defineReactive(data, key, data[key])\n    })\n  }\n  observerArray(value) {\n    value.forEach((item, index) => {\n      observer(item)\n    })\n  }\n}\n\nexport function observer(data) {\n  // 数据的劫持\n  // console.log(\"数据的劫持\")\n  // 判断是否是对象\n  let isObj = isObject(data)\n  // console.log(isObj)\n  if(!isObj) {\n    return\n  }\n  // 观测这个对象\n  return new Observer(data)\n}\n\n// 定义响应式数据\n// data对象里面的key 定义为响应式数据\nfunction defineReactive(data, key, value) {\n  // console.log(key, value)\n  observer(value)\n  Object.defineProperty(data, key, {\n    // 获取值的时候 做一些操作\n    get() {\n      return value\n    },\n    // 设置值的时候 做一些操作\n    set(newValue) {\n      console.log(\"重新设置了数据了\")\n      if(newValue === value) return\n      // 设置的值是对象  还需要再次进行数据的劫持\n      observer(newValue)\n      value = newValue\n    }\n  })\n}\n\nexport function initSet(Vue, vm) {\n  Vue.prototype.$set = function(target, key, value) {\n    // 响应式处理\n    defineReactive(target, key, value)\n    // vm._data = target\n  }\n}\n\nfunction setArray() {\n  let methods = [\n    'unshift',\n    'shift',\n    'pop',\n    'push',\n    'splice',\n    'sort',\n    'reverse'\n  ]\n  let oldPrototype = Array.prototype\n  methods.forEach((method) => {\n    Array.prototype[method] = function(value) {\n      console.log(oldPrototype)\n      // 这个会导致死循环\n      // let r = oldPrototype[method].call(this, value)\n      // return r\n    }\n  })\n}\n// for(let i = 0; i < methods.length; i++) {\n//   Array.prototype[methods[i]] = function(value) {\n//     console.log(value)\n//     // oldPrototype\n//     // oldPrototype[methods[i]].call(this, value)\n//     observer(value)\n//   }\n// }\n","// 初始化状态\nimport { observer } from '../observer/index.js'\nexport function initState(vm) {\n  const opts = vm.$options\n  // console.log(opts)\n  // vue的数据来源 属性 方法 数据 计算属性 watch\n  // 初始化 先属性 在方法\n  if(opts.props) {\n    initProps(vm)\n  }\n  if(opts.methods) {\n    initMethod(vm)\n  }\n  if(opts.data) {\n    initData(vm)\n    console.log(\"111111xxxxx\")\n    let keys = Object.keys(vm._data)\n    // 这边也是需要进行递归处理的\n    // 做一个代理  让用户可以直接通过 实例.xx 获取属性\n    keys.forEach((key, index) => {\n      // 也就是做一个引用而已  还是指向vm._data里面的数据\n      Object.defineProperty(vm, key, {\n        get() {\n          return vm._data[key]\n        },\n        set(newValue) {\n          vm._data[key] = newValue\n        }\n      })\n    })\n  }\n  if(opts.data) {\n    initComputed(vm)\n  }\n  if(opts.data) {\n    initWatch(vm)\n  }\n}\n\nfunction initProps(vm) {\n\n}\n\nfunction initMethod(vm) {\n  \n}\n\nfunction initData(vm) {\n  console.log('初始化数据')\n  let data = vm.$options.data\n  // data里面的this指向还是实例\n  data = vm._data = typeof data == 'function' ? data.call(vm) : data\n  // 初始化数据后，处理数据 让用户可以直接修改data里面的数据\n  // 将数据挂载到 vm._data 上面\n  // console.log(vm._data, 'vm._data')\n  // 对象劫持 用户改变了数据 我希望可以得到通知刷新页面\n  observer(data) // 响应式原理\n}\n\nfunction initComputed(vm) {\n  \n}\n\nfunction initWatch(vm) {\n  \n}\n","import { initState } from './state'\nimport { initSet } from '../observer/index'\n\n// 在原型上添加一个init方法\nexport function initMixin(Vue) {\n  Vue.prototype._init = function(options) {\n    // 数据的劫持 当前的实例就是this\n    const vm = this\n    // this.$options 指代的就是用户传递的属性\n    vm.$options = options\n    \n    initSet(Vue)\n    // 初始化状态\n    initState(vm)\n  }\n}\n","// Vue的核心代码 这个文件相当于整合的功能\nimport { initMixin } from './init/init'\nfunction Vue(options) {\n  // 进行vue的初始化\n  this._init(options)\n}\n// let vue = require('vue')\n// console.log(vue)\n// 通过引入文件的方式，给vue原型上添加方法\n// 执行一下 把大 Vue传递进去\ninitMixin(Vue)\n\n// initRender(Vue)\nexport default Vue\n\n// function React() {\n//   console.log('react')\n//   this.a = 'sgjm'\n//   this._init()\n// }\n\n// // 原型上的方法 可以获取当前的实例\n// React.prototype._init = function() {\n//   console.log(this)\n// }\n\n// new React()\n"],"names":["isObject","data","Observer","value","Array","isArray","setArray","observerArray","walk","keys","Object","forEach","key","defineReactive","item","index","observer","isObj","defineProperty","get","set","newValue","console","log","initSet","Vue","vm","prototype","$set","target","methods","oldPrototype","method","initState","opts","$options","props","initData","_data","call","initMixin","_init","options"],"mappings":"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"}